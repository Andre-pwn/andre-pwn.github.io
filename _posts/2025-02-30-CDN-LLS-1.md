---
title: Low Latency Streaming
author: Leesh
categories: [CDN, Media, LLS]
tags: [CDN, Media, LLS, WebRTC, Low Latency Streaming, WHIP, WHEP ]
date: '2025-01-23 13:48:00 +0900'
mermaid: true
---


## 1. 초저지연 스트리밍(Low Latency Streaming)이란 무엇인가?

---
초저지연 스트리밍은 시청자가 방송되는 콘텐츠를 거의 실시간으로 시청할 수 있도록 하는 기술입니다.<br>
기존의 스트리밍 방식(HLS, DASH)은 콘텐츠가 시청자에게 도달하기까지 상당한 지연 시간(약 5-10s)을 발생시킵니다.<br>
이는 실시간 상호 작용이 중요한 온라인 교육, 경매, 미팅 등에는 적합하지 않습니다.<br>
초저지연 스트리밍은 이러한 지연 시간을 최소화하여 시청자가 실제 상황과 거의 동시에 콘텐츠를 시청할 수 있게 하고, 밀리초(ms) 수준의 지연 시간을 목표로 합니다.


## 2. WebRTC란 무엇인가?


---
WebRTC (Web Real-Time Communication)는 웹 브라우저 및 모바일 애플리케이션 간에 플러그인이나 추가적인 소프트웨어 설치 없이 실시간 통신을 가능하게 하는 기술입니다.<br>
오디오, 비디오, 데이터 등 다양한 미디어를 낮은 지연 시간으로 전송할 수 있어 화상 회의, 온라인 게임, 라이브 스트리밍 등의 분야에서 활용되고 있습니다.


**WebRTC의 주요 특징**

*   **매우 낮은 지연 시간:** 실시간 상호 작용에 필수적인 매우 낮은 지연 시간을 제공합니다.
*   **브라우저 기반:** 별도의 프로그램 설치 없이 웹 브라우저만으로 통신이 가능합니다.
*   **다양한 미디어 지원:** 오디오, 비디오, 데이터 등 다양한 미디어 유형을 전송할 수 있습니다.
*   **보안:** DTLS (Datagram Transport Layer Security) 및 SRTP (Secure Real-time Transport Protocol)와 같은 보안 프로토콜을 사용하여 통신 내용을 암호화합니다.

## 3. 왜 WebRTC를 사용해야 하는가?

---
*   **최소한의 지연 시간:** 기존의 스트리밍 프로토콜(RTMP, HLS 등)에 비해 월등히 낮은 지연 시간을 제공
*   **양방향 통신 지원:** 단순한 스트리밍뿐만 아니라 시청자와의 실시간 소통이 가능
*   **웹 표준 기반:** 별도의 플러그인 없이 웹 브라우저에서 바로 작동하므로 사용자 접근성이 뛰어남

## 4. WebRTC 구현의 핵심 기술

---
### 4.1 SDP (Session Description Protocol)

SDP는 WebRTC 장치가 **통신**하는 데 사용하는 **언어** 역할을 하는 텍스트 기반 프로토콜입니다.<br>
WebRTC 연결을 설정하기 전에 장치간에 SDP를 교환하여 서로의 기능(지원하는 코덱, 네트워크 주소, 포트 등)을 협상합니다.

*   **미디어 유형:** 오디오, 비디오 등
*   **코덱:** 사용하는 압축 방식
*   **네트워크 주소 및 포트:** 통신에 사용할 IP 주소 및 포트 번호
*   **기타 설정:** 대역폭, 암호화 방식 등

#### SDP 프로토콜 구문
```text
v=0                                       // SDP 버전 (0)
o=- 5318854650535376891 2 IN IP4 163.171.72.202 // Origin: 세션 생성자 정보. (-: 세션 ID, 5318854650535376891: 버전, 2: 세션 수정 버전, IN: 인터넷 주소 체계, IP4: IPv4 주소, 163.171.72.202: 호스트 IP 주소)
s=-                                       // 세션 이름 (여기서는 없음)
t=0 0                                     // 세션 시간 (0 0: 영구 세션)
a=ice-lite                             // ICE Lite 모드 사용 (최소한의 ICE 기능만 사용)
a=group:BUNDLE 0 1                       // 미디어 스트림 번들링 (mid 0과 1을 하나의 ICE 연결로 묶음)
a=msid-semantic: WMS wsrtc                // 미디어 스트림 ID 의미 (WMS: Web Media Server, wsrtc: 세션 ID)
m=audio 9 UDP/TLS/RTP/SAVPF 111           // 미디어 설명: 오디오 (m=audio), 포트 9 (실제 포트는 ICE 협상 후 결정), UDP/TLS/RTP/SAVPF: 전송 프로토콜 (UDP 위에 TLS, RTP, SAVPF 사용), 111: 페이로드 타입 (Opus 코덱)
c=IN IP4 163.171.72.202                  // 연결 정보: IP 주소 (세션 레벨과 동일)
a=ice-ufrag:2F09_1498_6790A6DC_733_14     // ICE 사용자 이름 조각 (ICE 협상에 사용)
a=ice-pwd:Zd5IfYovIykOHtS4/bSHBg         // ICE 비밀번호 (ICE 협상에 사용)
a=fingerprint:sha-256 B7:F8:14:6C:9C:F5:C8:51:FC:34:73:00:AA:03:4E:B9:B3:B4:B7:FF:52:8F:9A:EE:4A:DC:D6:B0:97:BC:02:92 // TLS/DTLS 지문 (상대방의 인증서 확인에 사용)
a=setup:passive                          // DTLS 설정: 수동 모드 (상대방이 연결 시작)
a=mid:0                                   // 미디어 ID: 0 (오디오)
a=sendonly                             // 전송 방향: 송신 전용
a=rtcp-mux                             // RTCP 멀티플렉싱 (RTP와 RTCP를 같은 포트로 전송)
a=rtpmap:111 opus/48000/2                // RTP 맵: 페이로드 타입 111은 Opus 코덱, 48000Hz 샘플링, 2 채널
a=fmtp:111 minptime=10;useinbandfec=1       // 포맷 파라미터: 최소 패킷 간격 10ms, 인밴드 FEC 사용
a=rtcp-fb:111 transport-cc               // RTCP 피드백: 전송 제어 피드백
a=ssrc:360103485 cname:wsrtcaudio         // SSRC: 360103485, CNAME: wsrtcaudio (오디오 스트림 식별)
a=ssrc:360103485 msid:wsrtc wsrtca0      // SSRC에 연결된 미디어 스트림 ID
a=ssrc:360103485 mslabel:wsrtc           // 미디어 스트림 레이블
a=ssrc:360103485 label:wsrtca0          // 미디어 레이블
a=candidate:1 1 udp 2013266431 163.171.72.202 16000 typ host // ICE 후보: 로컬 호스트 후보, 우선순위 1, 컴포넌트 ID 1, UDP 프로토콜, 포트 16000

m=video 9 UDP/TLS/RTP/SAVPF 108 45        // 미디어 설명: 비디오 (m=video), 포트 9 (실제 포트는 ICE 협상 후 결정), UDP/TLS/RTP/SAVPF: 전송 프로토콜, 108: H.264, 45: AV1 페이로드 타입
c=IN IP4 163.171.72.202                  // 연결 정보: IP 주소 (세션 레벨과 동일)
a=ice-ufrag:2F09_1498_6790A6DC_733_14     // ICE 사용자 이름 조각 (오디오와 동일)
a=ice-pwd:Zd5IfYovIykOHtS4/bSHBg         // ICE 비밀번호 (오디오와 동일)
a=fingerprint:sha-256 B7:F8:14:6C:9C:F5:C8:51:FC:34:73:00:AA:03:4E:B9:B3:B4:B7:FF:52:8F:9A:EE:4A:DC:D6:B0:97:BC:02:92 // TLS/DTLS 지문 (오디오와 동일)
a=setup:passive                          // DTLS 설정: 수동 모드 (오디오와 동일)
a=mid:1                                   // 미디어 ID: 1 (비디오)
a=sendonly                             // 전송 방향: 송신 전용
a=rtcp-mux                             // RTCP 멀티플렉싱 (오디오와 동일)
a=rtpmap:108 H264/90000                  // RTP 맵: 페이로드 타입 108은 H.264 코덱, 90000Hz 클럭 속도
a=fmtp:108 profile-level-id=42e01f;packetization-mode=1 // H.264 포맷 파라미터
a=rtcp-fb:108 ccm fir                     // RTCP 피드백: 전체 프레임 요청
a=rtcp-fb:108 nack                        // RTCP 피드백: NACK (손실된 패킷 재전송 요청)
a=rtcp-fb:108 nack pli                    // RTCP 피드백: PLI (픽처 로스 인디케이터)
a=rtcp-fb:108 goog-remb                   // RTCP 피드백: 구글 REMB (대역폭 추정)
a=rtcp-fb:108 transport-cc               // RTCP 피드백: 전송 제어 피드백
a=rtpmap:45 AV1/90000                    // RTP 맵: 페이로드 타입 45는 AV1 코덱, 90000Hz 클럭 속도
a=rtcp-fb:45 ccm fir                     // RTCP 피드백: 전체 프레임 요청
a=rtcp-fb:45 nack                        // RTCP 피드백: NACK (손실된 패킷 재전송 요청)
a=rtcp-fb:45 nack pli                    // RTCP 피드백: PLI (픽처 로스 인디케이터)
a=rtcp-fb:45 goog-remb                   // RTCP 피드백: 구글 REMB (대역폭 추정)
a=rtcp-fb:45 transport-cc               // RTCP 피드백: 전송 제어 피드백
a=ssrc:690506733 cname:wsrtcvideo         // SSRC: 690506733, CNAME: wsrtcvideo (비디오 스트림 식별)
a=ssrc:690506733 msid:wsrtc wsrtcv0      // SSRC에 연결된 미디어 스트림 ID
a=ssrc:690506733 mslabel:wsrtc           // 미디어 스트림 레이블
a=ssrc:690506733 label:wsrtcv0          // 미디어 레이블
a=candidate:1 1
```



### 4.2 WHIP (WebRTC HTTP Ingestion Protocol)

WHIP는 WebRTC를 사용하여 미디어를 서버에 전송하기 위한 프로토콜입니다.<br>
HTTP 기반으로 작동하며, 클라이언트(예: 방송 송출자)가 서버에 미디어를 업로드하는 과정을 단순화합니다.<br>
기존의 복잡한 시그널링 과정을 HTTP 요청으로 대체하여 WebRTC 스트림 전송을 간소화합니다.

### 4.3 WHEP (WebRTC HTTP Egress Protocol)

WHEP는 WHIP와 반대로 서버에서 클라이언트로 WebRTC 스트림을 전송하기 위한 프로토콜입니다.<br>
이 또한 HTTP 기반으로 작동하며, 클라이언트(예: 시청자)가 서버로부터 WebRTC 스트림을 수신하는 과정을 간소화합니다.

WHIP/WHEP는 CDN (Content Delivery Network)과 결합하여 전 세계 사용자에게 안정적인 초저지연 스트리밍 서비스를 제공할 수 있습니다.<br>
방송 송출자는 WHIP를 통해 서버에 스트림을 전송하고, 시청자는 WHEP를 통해 CDN으로부터 스트림을 수신할 수 있습니다.
